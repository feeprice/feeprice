---
title: "Assignment 2"
output: html_document
date: "2024-10-02"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(here)
library(dplyr)


boone <- read.csv(file = 
    here("./Data Raw/Boone_daily_precip_1980-present_HUC_050500010201_dayMet_split-dates-columns.csv"),
    stringsAsFactors = TRUE)

boone_clean <- boone[!is.nan(boone$Area.Weighted.Mean.Precipitation..mm.per.day.), ]
boone_clean_no_zero <- boone_clean %>% 
  filter(Area.Weighted.Mean.Precipitation..mm.per.day. > 0)

greensboro <- read.csv(file = 
    here("./Data Raw/Greensboro_daily_precip_1980-present_HUC_030300020105_dayMet_split-dates-columns.csv"),
    stringsAsFactors = TRUE)

greensboro_clean <- greensboro[!is.nan(greensboro$Area.Weighted.Mean.Precipitation..mm.per.day.), ]

greenville <- read.csv(file = 
    here("./Data Raw/Greenville_daily_precip_1980-present_HUC_030201030403_dayMet_split-dates-columns.csv"),
    stringsAsFactors = TRUE)

greenville_clean <- greenville[!is.nan(greensboro$Area.Weighted.Mean.Precipitation..mm.per.day.), ]

```

```{r, boone subset}
#Boone annual daily max
early_boone <- boone %>% 
  filter(year < 2000)

early_boone_annual <- boone_clean %>% 
  filter(year < 2000) %>% 
  group_by(year) %>% 
  summarise(daily_max_annual = max(Area.Weighted.Mean.Precipitation..mm.per.day.))

late_boone <- boone %>% 
  filter(year >= 2000)

late_boone_annual <- boone_clean %>% 
  filter(year >= 2000) %>% 
  group_by(year) %>% 
  summarise(daily_max_annual = max(Area.Weighted.Mean.Precipitation..mm.per.day.))


#Boone annual sum

early_boone_annualsum <- boone_clean %>% 
  filter(year < 2000) %>% 
  group_by(year) %>% 
  summarise(annual_sum = sum(Area.Weighted.Mean.Precipitation..mm.per.day.))

late_boone_annualsum <- boone_clean %>% 
  filter(year >= 2000) %>% 
  group_by(year) %>% 
  summarise(annual_sum = sum(Area.Weighted.Mean.Precipitation..mm.per.day.))

#Boone monthly sum
early_boone_monthsum <- boone_clean %>% 
  filter(year < 2000) %>% 
  group_by(month, year) %>% 
  summarise(monthly_sum_by_year = sum(Area.Weighted.Mean.Precipitation..mm.per.day.))

#Boone monthly sum
late_boone_monthsum <- boone_clean %>% 
  filter(year >= 2000) %>% 
  group_by(month, year) %>% 
  summarise(monthly_sum_by_year = sum(Area.Weighted.Mean.Precipitation..mm.per.day.))
```

```{r}
early_boone <- early_boone %>% 
  filter(Area.Weighted.Mean.Precipitation..mm.per.day. > 0) %>% 
  mutate(rank = rank(-Area.Weighted.Mean.Precipitation..mm.per.day.,
                        ties.method = "average")) %>% 
  mutate(number_events = 2768) %>% 
  mutate(plotting_position = ((100*((2*rank) - 1))/(2*number_events))) %>% 
  mutate(weibull = ((number_events + 1)/rank)) %>% 
  mutate(return_period = 100/plotting_position)

#rp using daily max for early period
rp_early_boone <- early_boone_annual %>% 
  mutate(rank = rank(-daily_max_annual,
                        ties.method = "max")) %>% 
  mutate(number_events = 20) %>% 
  mutate(plotting_position = ((100*((2*rank) - 1))/(2*number_events))) %>% 
  mutate(weibull = ((number_events + 1)/rank)) %>% 
  mutate(return_period = 100/plotting_position)

#rp using annual sum for early period
rp_early_boone_annual <- early_boone_annualsum %>% 
  mutate(rank = rank(-annual_sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 20) %>% 
  mutate(plotting_position = ((100*((2*rank) - 1))/(2*number_events))) %>% 
  mutate(weibull = ((number_events + 1)/rank)) %>% 
  mutate(return_period = 100/plotting_position)


#rp using daily max for late period
rp_late_boone <- late_boone_annual %>% 
  mutate(rank = rank(-daily_max_annual,
                        ties.method = "max")) %>% 
  mutate(number_events = 16) %>% 
  mutate(plotting_position = ((100*((2*rank) - 1))/(2*number_events))) %>% 
  mutate(weibull = ((number_events + 1)/rank)) %>% 
  mutate(return_period = 100/plotting_position)

#rp using annual sum for late period
rp_late_boone_annual <- late_boone_annualsum %>% 
  mutate(rank = rank(-annual_sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 16) %>% 
  mutate(plotting_position = ((100*((2*rank) - 1))/(2*number_events))) %>% 
  mutate(weibull = ((number_events + 1)/rank)) %>% 
  mutate(return_period = 100/plotting_position)


```

```{r}
#Maximum daily values
#early
ggplot(early_boone_annual, aes(x = year, y = daily_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") 

#late
ggplot(late_boone_annual, aes(x = year, y = daily_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") 

#Annual sums
#early
ggplot(early_boone_annualsum, aes(x = year, y = annual_sum)) +
  geom_line() +
  geom_smooth(method = "lm") 

#late
ggplot(late_boone_annualsum, aes(x = year, y = annual_sum)) +
  geom_line() +
  geom_smooth(method = "lm") 
```


```{r moving sum, echo=FALSE}
#moving sum with early Boone
library(zoo)
moving_sum_early_boone <- rollapply(early_boone$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

moving_early_boone <- data.frame(
  Original_Data = early_boone,
  Moving_Sum = moving_sum_early_boone
)

rp_early_boone_moving <- moving_early_boone %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(number_events = 3986) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 66 mm

ggplot(early_boone_annual, aes(x = year, y = daily_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") +
  geom_hline(yintercept = 66, color = "red", linetype = "dashed", size = 1) +
    scale_x_continuous(breaks = seq(1980, 1999, 1)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 


moving_sum_late_boone <- rollapply(late_boone$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

moving_late_boone <- data.frame(
  Original_Data = late_boone,
  Moving_Sum = moving_sum_late_boone
)

rp_late_boone_moving <- moving_late_boone %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(number_events = 3460) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 80 mm

ggplot(late_boone_annual, aes(x = year, y = daily_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") +
  geom_hline(yintercept = 68, color = "red", linetype = "dashed", size = 1) +
  scale_x_continuous(breaks = seq(2000, 2016, 1)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

```

```{r}
#moving sum with early Greensboro

early_greensboro <- greensboro %>% 
  filter(year < 2000)

moving_sum_early_greensboro <- rollapply(early_greensboro$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

moving_early_greensboro <- data.frame(
  Original_Data = early_greensboro,
  Moving_Sum = moving_sum_early_greensboro
)

rp_early_greensboro_moving <- moving_early_greensboro %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(number_events = 3291) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 55 mm

early_greensboro_annual <- greensboro_clean %>% 
  filter(year < 2000) %>% 
  group_by(year) %>% 
  summarise(daily_max_annual = max(Area.Weighted.Mean.Precipitation..mm.per.day.))

ggplot(early_greensboro_annual, aes(x = year, y = daily_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") +
  geom_hline(yintercept = 55, color = "red", linetype = "dashed", size = 1) +
    scale_x_continuous(breaks = seq(1980, 1999, 1)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 


late_greensboro <- greensboro %>% 
  filter(year >= 2000)

late_greensboro_annual <- greensboro_clean %>% 
  filter(year >= 2000) %>% 
  group_by(year) %>% 
  summarise(daily_max_annual = max(Area.Weighted.Mean.Precipitation..mm.per.day.))

moving_sum_late_greensboro <- rollapply(late_greensboro$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

moving_late_greensboro <- data.frame(
  Original_Data = late_greensboro,
  Moving_Sum = moving_sum_late_greensboro
)

rp_late_greensboro_moving <- moving_late_greensboro %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(number_events = 2879) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 55 mm

ggplot(late_greensboro_annual, aes(x = year, y = daily_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") +
  geom_hline(yintercept = 55, color = "red", linetype = "dashed", size = 1) +
  scale_x_continuous(breaks = seq(2000, 2016, 1)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

```


```{r}
#moving sum with early Greenville

early_greenville <- greenville %>% 
  filter(year < 2000)

moving_sum_early_greenville <- rollapply(early_greenville$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

moving_early_greenville <- data.frame(
  Original_Data = early_greenville,
  Moving_Sum = moving_sum_early_greenville
)

rp_early_greenville_moving <- moving_early_greenville %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(number_events = 3393) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 59 mm

early_greenville_annual <- greenville_clean %>% 
  filter(year < 2000) %>% 
  group_by(year) %>% 
  summarise(daily_max_annual = max(Area.Weighted.Mean.Precipitation..mm.per.day.))

ggplot(early_greenville_annual, aes(x = year, y = daily_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") +
  geom_hline(yintercept = 59, color = "red", linetype = "dashed", size = 1) +
    scale_x_continuous(breaks = seq(1980, 1999, 1)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 


late_greenville <- greenville %>% 
  filter(year >= 2000)

late_greenville_annual <- greenville_clean %>% 
  filter(year >= 2000) %>% 
  group_by(year) %>% 
  summarise(daily_max_annual = max(Area.Weighted.Mean.Precipitation..mm.per.day.))

moving_sum_late_greenville <- rollapply(late_greenville$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

moving_late_greenville <- data.frame(
  Original_Data = late_greensboro,
  Moving_Sum = moving_sum_late_greenville
)

rp_late_greenville_moving <- moving_late_greenville %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 2907) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 67 mm

ggplot(late_greenville_annual, aes(x = year, y = daily_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") +
  geom_hline(yintercept = 67, color = "red", linetype = "dashed", size = 1) +
  scale_x_continuous(breaks = seq(2000, 2016, 1)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 




```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
