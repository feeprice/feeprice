---
title: "Assignment 2"
output: html_document
date: "2024-10-02"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(here)
library(dplyr)


boone <- read.csv(file = 
    here("./Data Raw/Boone_daily_precip_1980-present_HUC_050500010201_dayMet_split-dates-columns.csv"),
    stringsAsFactors = TRUE)

boone_clean <- boone[!is.nan(boone$Area.Weighted.Mean.Precipitation..mm.per.day.), ]
boone_clean_no_zero <- boone_clean %>% 
  filter(Area.Weighted.Mean.Precipitation..mm.per.day. > 0)

greensboro <- read.csv(file = 
    here("./Data Raw/Greensboro_daily_precip_1980-present_HUC_030300020105_dayMet_split-dates-columns.csv"),
    stringsAsFactors = TRUE)

greensboro_clean <- greensboro[!is.nan(greensboro$Area.Weighted.Mean.Precipitation..mm.per.day.), ]

greenville <- read.csv(file = 
    here("./Data Raw/Greenville_daily_precip_1980-present_HUC_030201030403_dayMet_split-dates-columns.csv"),
    stringsAsFactors = TRUE)

greenville_clean <- greenville[!is.nan(greensboro$Area.Weighted.Mean.Precipitation..mm.per.day.), ]

```

```{r, boone subset}
#Boone annual daily max
early_boone <- boone %>% 
  filter(year < 2000)

early_boone_annual <- boone_clean %>% 
  filter(year < 2000) %>% 
  group_by(year) %>% 
  summarise(daily_max_annual = max(Area.Weighted.Mean.Precipitation..mm.per.day.))

late_boone <- boone %>% 
  filter(year >= 2000)

late_boone_annual <- boone_clean %>% 
  filter(year >= 2000) %>% 
  group_by(year) %>% 
  summarise(daily_max_annual = max(Area.Weighted.Mean.Precipitation..mm.per.day.))


#Boone annual sum

early_boone_annualsum <- boone_clean %>% 
  filter(year < 2000) %>% 
  group_by(year) %>% 
  summarise(annual_sum = sum(Area.Weighted.Mean.Precipitation..mm.per.day.))

late_boone_annualsum <- boone_clean %>% 
  filter(year >= 2000) %>% 
  group_by(year) %>% 
  summarise(annual_sum = sum(Area.Weighted.Mean.Precipitation..mm.per.day.))

#Boone monthly sum
early_boone_monthsum <- boone_clean %>% 
  filter(year < 2000) %>% 
  group_by(month, year) %>% 
  summarise(monthly_sum_by_year = sum(Area.Weighted.Mean.Precipitation..mm.per.day.))

#Boone monthly sum
late_boone_monthsum <- boone_clean %>% 
  filter(year >= 2000) %>% 
  group_by(month, year) %>% 
  summarise(monthly_sum_by_year = sum(Area.Weighted.Mean.Precipitation..mm.per.day.))
```

```{r}
early_boone <- early_boone %>% 
  filter(Area.Weighted.Mean.Precipitation..mm.per.day. > 0) %>% 
  mutate(rank = rank(-Area.Weighted.Mean.Precipitation..mm.per.day.,
                        ties.method = "average")) %>% 
  mutate(number_events = 2768) %>% 
  mutate(plotting_position = ((100*((2*rank) - 1))/(2*number_events))) %>% 
  mutate(weibull = ((number_events + 1)/rank)) %>% 
  mutate(return_period = 100/plotting_position)

#rp using daily max for early period
rp_early_boone <- early_boone_annual %>% 
  mutate(rank = rank(-daily_max_annual,
                        ties.method = "max")) %>% 
  mutate(number_events = 20) %>% 
  mutate(plotting_position = ((100*((2*rank) - 1))/(2*number_events))) %>% 
  mutate(weibull = ((number_events + 1)/rank)) %>% 
  mutate(return_period = 100/plotting_position)

#rp using annual sum for early period
rp_early_boone_annual <- early_boone_annualsum %>% 
  mutate(rank = rank(-annual_sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 20) %>% 
  mutate(plotting_position = ((100*((2*rank) - 1))/(2*number_events))) %>% 
  mutate(weibull = ((number_events + 1)/rank)) %>% 
  mutate(return_period = 100/plotting_position)


#rp using daily max for late period
rp_late_boone <- late_boone_annual %>% 
  mutate(rank = rank(-daily_max_annual,
                        ties.method = "max")) %>% 
  mutate(number_events = 16) %>% 
  mutate(plotting_position = ((100*((2*rank) - 1))/(2*number_events))) %>% 
  mutate(weibull = ((number_events + 1)/rank)) %>% 
  mutate(return_period = 100/plotting_position)

#rp using annual sum for late period
rp_late_boone_annual <- late_boone_annualsum %>% 
  mutate(rank = rank(-annual_sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 16) %>% 
  mutate(plotting_position = ((100*((2*rank) - 1))/(2*number_events))) %>% 
  mutate(weibull = ((number_events + 1)/rank)) %>% 
  mutate(return_period = 100/plotting_position)


```

```{r}
#Maximum daily values
#early
ggplot(early_boone_annual, aes(x = year, y = daily_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") 

#late
ggplot(late_boone_annual, aes(x = year, y = daily_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") 

#Annual sums
#early
ggplot(early_boone_annualsum, aes(x = year, y = annual_sum)) +
  geom_line() +
  geom_smooth(method = "lm") 

#late
ggplot(late_boone_annualsum, aes(x = year, y = annual_sum)) +
  geom_line() +
  geom_smooth(method = "lm") 
```


```{r moving sum, echo=FALSE}
#moving sum with early Boone
library(zoo)
moving_sum_early_boone <- rollapply(early_boone$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

moving_early_boone <- data.frame(
  Original_Data = early_boone,
  Moving_Sum = moving_sum_early_boone
) %>% 
  filter(Moving_Sum > 0)

#didn't use this
movingearly_boone_annual <- moving_early_boone %>% 
  filter(Original_Data.year < 2000) %>% 
  group_by(Original_Data.year) %>% 
  summarise(twoday_max_annual = max(Moving_Sum))


rp_early_boone_moving <- moving_early_boone %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(number_events = 3986) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 66 mm

ggplot(movingearly_boone_annual, aes(x = Original_Data.year, y = twoday_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") +
  geom_hline(yintercept = 66, color = "red", linetype = "dashed", size = 1) +
    scale_x_continuous(breaks = seq(1980, 1999, 1)) +
  labs(title = "Annual Maximum Two-Day Precipitation Events for Boone\nfrom 1980-1999",
       x = "Year",
       y = "Depth of precipitation (mm)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


moving_sum_late_boone <- rollapply(late_boone$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

moving_late_boone <- data.frame(
  Original_Data = late_boone,
  Moving_Sum = moving_sum_late_boone
) %>% 
  filter(Moving_Sum > 0)

movinglate_boone_annual <- moving_late_boone %>% 
  filter(Original_Data.year >= 2000) %>% 
  group_by(Original_Data.year) %>% 
  summarise(twoday_max_annual = max(Moving_Sum))

rp_late_boone_moving <- moving_late_boone %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(number_events = 3460) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 80 mm

ggplot(movinglate_boone_annual, aes(x = Original_Data.year, y = twoday_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") +
  geom_hline(yintercept = 68, color = "red", linetype = "dashed", size = 1) +
  scale_x_continuous(breaks = seq(2000, 2016, 1)) +
    labs(title = "Annual Maximum Two-Day Precipitation Events for Boone\nfrom 2000-2016",
       x = "Year",
       y = "Depth of precipitation (mm)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
#moving sum with early Greensboro

early_greensboro <- greensboro %>% 
  filter(year < 2000)

moving_sum_early_greensboro <- rollapply(early_greensboro$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

moving_early_greensboro <- data.frame(
  Original_Data = early_greensboro,
  Moving_Sum = moving_sum_early_greensboro
) %>% 
  filter(Moving_Sum > 0)

movingearly_greensboro_annual <- moving_early_greensboro  %>% 
  filter(Original_Data.year < 2000) %>% 
  group_by(Original_Data.year) %>% 
  summarise(twoday_max_annual = max(Moving_Sum))


rp_early_greensboro_moving <- moving_early_greensboro %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(number_events = 3291) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 55 mm



ggplot(movingearly_greensboro_annual, aes(x = Original_Data.year, y = twoday_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") +
  geom_hline(yintercept = 55, color = "red", linetype = "dashed", size = 1) +
    scale_x_continuous(breaks = seq(1980, 1999, 1)) +
  labs(title = "Annual Maximum Two-Day Precipitation Events for Greensboro\nfrom   1980-1999",
       x = "Year",
       y = "Depth of precipitation (mm)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  


late_greensboro <- greensboro %>% 
  filter(year >= 2000)

late_greensboro_annual <- greensboro %>% 
  filter(year >= 2000) %>% 
  group_by(year) %>% 
  summarise(daily_max_annual = max(Area.Weighted.Mean.Precipitation..mm.per.day.))

moving_sum_late_greensboro <- rollapply(late_greensboro$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

moving_late_greensboro <- data.frame(
  Original_Data = late_greensboro,
  Moving_Sum = moving_sum_late_greensboro
) %>% 
  filter(Moving_Sum > 0)

movinglate_greensboro_annual <- moving_late_greensboro  %>% 
  filter(Original_Data.year >= 2000) %>% 
  group_by(Original_Data.year) %>% 
  summarise(twoday_max_annual = max(Moving_Sum))

rp_late_greensboro_moving <- moving_late_greensboro %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(number_events = 2879) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 55 mm

ggplot(movinglate_greensboro_annual, aes(x = Original_Data.year, y = twoday_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") +
  geom_hline(yintercept = 55, color = "red", linetype = "dashed", size = 1) +
  scale_x_continuous(breaks = seq(2000, 2016, 1)) +
  labs(title = "Annual Maximum Two-Day Precipitation Events for Greensboro\nfrom   2000-2016",
       x = "Year",
       y = "Depth of precipitation (mm)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 


```


```{r}
#moving sum with early Greenville

early_greenville <- greenville %>% 
  filter(year < 2000)

moving_sum_early_greenville <- rollapply(early_greenville$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

moving_early_greenville <- data.frame(
  Original_Data = early_greenville,
  Moving_Sum = moving_sum_early_greenville
) %>% 
  filter(Moving_Sum > 0)

movingearly_greenville_annual <- moving_early_greenville  %>% 
  filter(Original_Data.year < 2000) %>% 
  group_by(Original_Data.year) %>% 
  summarise(twoday_max_annual = max(Moving_Sum))

rp_early_greenville_moving <- moving_early_greenville %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(number_events = 3393) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 59 mm

early_greenville_annual <- greenville_clean %>% 
  filter(year < 2000) %>% 
  group_by(year) %>% 
  summarise(daily_max_annual = max(Area.Weighted.Mean.Precipitation..mm.per.day.))

ggplot(movingearly_greenville_annual, aes(x = Original_Data.year, y = twoday_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") +
  geom_hline(yintercept = 59, color = "red", linetype = "dashed", size = 1) +
    scale_x_continuous(breaks = seq(1980, 1999, 1)) +
  labs(title = "Annual Maximum Two-Day Precipitation Events for Greenville\nfrom   1980-1999",
       x = "Year",
       y = "Depth of precipitation (mm)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 


late_greenville <- greenville %>% 
  filter(year >= 2000)

late_greenville_annual <- greenville_clean %>% 
  filter(year >= 2000) %>% 
  group_by(year) %>% 
  summarise(daily_max_annual = max(Area.Weighted.Mean.Precipitation..mm.per.day.))

moving_sum_late_greenville <- rollapply(late_greenville$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

moving_late_greenville <- data.frame(
  Original_Data = late_greensboro,
  Moving_Sum = moving_sum_late_greenville
) %>% 
  filter(Moving_Sum > 0)

movinglate_greenville_annual <- moving_late_greenville  %>% 
  filter(Original_Data.year >= 2000) %>% 
  group_by(Original_Data.year) %>% 
  summarise(twoday_max_annual = max(Moving_Sum))

rp_late_greenville_moving <- moving_late_greenville %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 2907) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 67 mm


ggplot(movinglate_greenville_annual, aes(x = Original_Data.year, y = twoday_max_annual)) +
  geom_line() +
  geom_smooth(method = "lm") +
  geom_hline(yintercept = 67, color = "red", linetype = "dashed", size = 1) +
  scale_x_continuous(breaks = seq(2000, 2016, 1)) +
  labs(title = "Annual Maximum Two-Day Precipitation Events for Greenville\nfrom   2000-2016",
       x = "Year",
       y = "Depth of precipitation (mm)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 




```

```{r}
#Seasonal, boone 1980-1999
hurricane_boone <- boone %>% 
  filter(month == 7:10) %>% 
  filter(year < 2000)

frontal_boone <- boone %>% 
  filter(month == 1:6 | month == 11:12) %>% 
  filter(year < 2000)

sum_boone_hurricane <- rollapply(hurricane_boone$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

movingsum_boone_hurricane <- data.frame(
  Original_Data = hurricane_boone,
  Moving_Sum = sum_boone_hurricane
) %>% 
  filter(Moving_Sum > 0)

rp_boone_hurricane <- movingsum_boone_hurricane %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 355) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 52 mm

sum_boone_frontal <- rollapply(frontal_boone$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

movingsum_boone_frontal <- data.frame(
  Original_Data = frontal_boone,
  Moving_Sum = sum_boone_frontal
) %>% 
  filter(Moving_Sum > 0)



rp_boone_frontal <- movingsum_boone_frontal %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 723) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 68 mm

rp_boone_frontal$StormType = "Frontal (1980-1999)"
rp_boone_hurricane$StormType = "Hurricane (1980-1999)"

boone_combined <- bind_rows(rp_boone_frontal, rp_boone_hurricane)

ggplot(boone_combined, aes(x = return_period, y = Moving_Sum, color = StormType)) +
  geom_line() +
  labs(title = "Return Period Storms in Boone for Frontal Season and\nHurricane Season, 1980-1999",
       x = "Return Period",
       y = "Depth of precipitation (mm)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 



#Seasonal, boone 2000-2016
hurricane_boone_2016 <- boone %>% 
  filter(month == 7:10) %>% 
  filter(year >= 2000)

frontal_boone_2016 <- boone %>% 
  filter(month == 1:6 | month == 11:12) %>% 
  filter(year >= 2000)

sum_boone_hurricane_2016 <- rollapply(hurricane_boone_2016$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

movingsum_boone_hurricane_2016 <- data.frame(
  Original_Data = hurricane_boone_2016,
  Moving_Sum = sum_boone_hurricane_2016
) %>% 
  filter(Moving_Sum > 0)

rp_boone_hurricane_2016 <- movingsum_boone_hurricane_2016 %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 319) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 75 mm

sum_boone_frontal_2016 <- rollapply(frontal_boone_2016$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

movingsum_boone_frontal_2016 <- data.frame(
  Original_Data = frontal_boone_2016,
  Moving_Sum = sum_boone_frontal_2016
) %>% 
  filter(Moving_Sum > 0)



rp_boone_frontal_2016 <- movingsum_boone_frontal_2016 %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 595) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 55 mm

rp_boone_frontal_2016$StormType = "Frontal (2000-2016)"
rp_boone_hurricane_2016$StormType = "Hurricane (2000-2016)"

boone_combined_all <- bind_rows(rp_boone_frontal, rp_boone_hurricane, rp_boone_frontal_2016, rp_boone_hurricane_2016)

ggplot(boone_combined_all, aes(x = return_period, y = Moving_Sum, color = StormType)) +
  geom_line(size = 1) +
  labs(title = "Return Period Storms in Boone for Frontal Season and\nHurricane Season",
       x = "Return Period (Years)",
       y = "Depth of precipitation (mm)",
       color = "Storm Type") +
    scale_color_manual(
    values = c("Frontal (1980-1999)" = "#FFCCCC",
               "Frontal (2000-2016)" = "red",
               "Hurricane (1980-1999)" = "#ADD8E6",
               "Hurricane (2000-2016)" = "blue")) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 




```


```{r}
#Seasonal, greensboro 1980-1999
hurricane_greensboro <- greensboro %>% 
  filter(month == 7:10) %>% 
  filter(year < 2000)

frontal_greensboro <- greensboro %>% 
  filter(month == 1:6 | month == 11:12) %>% 
  filter(year < 2000)

sum_greensboro_hurricane <- rollapply(hurricane_greensboro$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

movingsum_greensboro_hurricane <- data.frame(
  Original_Data = hurricane_greensboro,
  Moving_Sum = sum_greensboro_hurricane
) %>% 
  filter(Moving_Sum > 0)

rp_greensboro_hurricane <- movingsum_greensboro_hurricane %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 292) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 51 mm

sum_greensboro_frontal <- rollapply(frontal_greensboro$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

movingsum_greensboro_frontal <- data.frame(
  Original_Data = frontal_greensboro,
  Moving_Sum = sum_greensboro_frontal
) %>% 
  filter(Moving_Sum > 0)



rp_greensboro_frontal <- movingsum_greensboro_frontal %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 634) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 42 mm

rp_greensboro_frontal$StormType = "Frontal (1980-1999)"
rp_greensboro_hurricane$StormType = "Hurricane (1980-1999)"

greensboro_combined <- bind_rows(rp_greensboro_frontal, rp_greensboro_hurricane)

ggplot(greensboro_combined, aes(x = return_period, y = Moving_Sum, color = StormType)) +
  geom_line() +
  labs(title = "Return Period Storms in Greensboro for Frontal Season and\nHurricane Season, 1980-1999",
       x = "Return Period",
       y = "Depth of precipitation (mm)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 



#Seasonal, greensboro 2000-2016
hurricane_greensboro_2016 <- greensboro %>% 
  filter(month == 7:10) %>% 
  filter(year >= 2000)

frontal_greensboro_2016 <- greensboro %>% 
  filter(month == 1:6 | month == 11:12) %>% 
  filter(year >= 2000)

sum_greensboro_hurricane_2016 <- rollapply(hurricane_greensboro_2016$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

movingsum_greensboro_hurricane_2016 <- data.frame(
  Original_Data = hurricane_greensboro_2016,
  Moving_Sum = sum_greensboro_hurricane_2016
) %>% 
  filter(Moving_Sum > 0)

rp_greensboro_hurricane_2016 <- movingsum_greensboro_hurricane_2016 %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 285) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 69 mm

sum_greensboro_frontal_2016 <- rollapply(frontal_greensboro_2016$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

movingsum_greensboro_frontal_2016 <- data.frame(
  Original_Data = frontal_greensboro_2016,
  Moving_Sum = sum_greensboro_frontal_2016
) %>% 
  filter(Moving_Sum > 0)



rp_greensboro_frontal_2016 <- movingsum_greensboro_frontal_2016 %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 505) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 42 mm

rp_greensboro_frontal_2016$StormType = "Frontal (2000-2016)"
rp_greensboro_hurricane_2016$StormType = "Hurricane (2000-2016)"

greensboro_combined_all <- bind_rows(rp_greensboro_frontal, rp_greensboro_hurricane, rp_greensboro_frontal_2016, rp_greensboro_hurricane_2016)

ggplot(greensboro_combined_all, aes(x = return_period, y = Moving_Sum, color = StormType)) +
  geom_line(size = 1) +
  labs(title = "Return Period Storms in Greensboro for Frontal Season and\nHurricane Season",
       x = "Return Period (Years)",
       y = "Depth of precipitation (mm)",
       color = "Storm Type") +
  scale_color_manual(
    values = c("Frontal (1980-1999)" = "#FFCCCC",
               "Frontal (2000-2016)" = "red",
               "Hurricane (1980-1999)" = "#ADD8E6",
               "Hurricane (2000-2016)" = "blue")) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 




```


```{r}
#Seasonal, greenville 1980-1999
hurricane_greenville <- greenville %>% 
  filter(month == 7:10) %>% 
  filter(year < 2000)

frontal_greenville <- greenville %>% 
  filter(month == 1:6 | month == 11:12) %>% 
  filter(year < 2000)

sum_greenville_hurricane <- rollapply(hurricane_greenville$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

movingsum_greenville_hurricane <- data.frame(
  Original_Data = hurricane_greenville,
  Moving_Sum = sum_greenville_hurricane
) %>% 
  filter(Moving_Sum > 0)

rp_greenville_hurricane <- movingsum_greenville_hurricane %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 296) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 89 mm

sum_greenville_frontal <- rollapply(frontal_greenville$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

movingsum_greenville_frontal <- data.frame(
  Original_Data = frontal_greenville,
  Moving_Sum = sum_greenville_frontal
) %>% 
  filter(Moving_Sum > 0)



rp_greenville_frontal <- movingsum_greenville_frontal %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 623) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 44 mm

rp_greenville_frontal$StormType = "Frontal (1980-1999)"
rp_greenville_hurricane$StormType = "Hurricane (1980-1999)"

greenville_combined <- bind_rows(rp_greenville_frontal, rp_greenville_hurricane)

ggplot(greenville_combined, aes(x = return_period, y = Moving_Sum, color = StormType)) +
  geom_line() +
  labs(title = "Return Period Storms in Greenville for Frontal Season and\nHurricane Season, 1980-1999",
       x = "Return Period",
       y = "Depth of precipitation (mm)") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 



#Seasonal, greenville 2000-2016
hurricane_greenville_2016 <- greenville %>% 
  filter(month == 7:10) %>% 
  filter(year >= 2000)

frontal_greenville_2016 <- greenville %>% 
  filter(month == 1:6 | month == 11:12) %>% 
  filter(year >= 2000)

sum_greenville_hurricane_2016 <- rollapply(hurricane_greenville_2016$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

movingsum_greenville_hurricane_2016 <- data.frame(
  Original_Data = hurricane_greenville_2016,
  Moving_Sum = sum_greenville_hurricane_2016
) %>% 
  filter(Moving_Sum > 0)

rp_greenville_hurricane_2016 <- movingsum_greenville_hurricane_2016 %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 280) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 151 mm

sum_greenville_frontal_2016 <- rollapply(frontal_greenville_2016$Area.Weighted.Mean.Precipitation..mm.per.day., width = 2, FUN = sum, fill = NA, align = "right")

movingsum_greenville_frontal_2016 <- data.frame(
  Original_Data = frontal_greenville_2016,
  Moving_Sum = sum_greenville_frontal_2016
) %>% 
  filter(Moving_Sum > 0)



rp_greenville_frontal_2016 <- movingsum_greenville_frontal_2016 %>% 
  filter(Moving_Sum > 0) %>% 
  mutate(rank = rank(-Moving_Sum,
                        ties.method = "max")) %>% 
  mutate(number_events = 460) %>% 
  mutate(weibull = (rank/number_events)) %>% 
  mutate(return_period = 1/weibull)
#moving sum for 50-year 48-hour storm event = 54 mm

rp_greenville_frontal_2016$StormType = "Frontal (2000-2016)"
rp_greenville_hurricane_2016$StormType = "Hurricane (2000-2016)"

greenville_combined_all <- bind_rows(rp_greenville_frontal, rp_greenville_hurricane, rp_greenville_frontal_2016, rp_greenville_hurricane_2016)

ggplot(greenville_combined_all, aes(x = return_period, y = Moving_Sum, color = StormType)) +
  geom_line(size = 1) +
  labs(title = "Return Period Storms in Greenville for Frontal Season and\nHurricane Season",
       x = "Return Period (Years)",
       y = "Depth of precipitation (mm)",
       color = "Storm Type") +
  scale_color_manual(
    values = c("Frontal (1980-1999)" = "#FFCCCC",
               "Frontal (2000-2016)" = "red",
               "Hurricane (1980-1999)" = "#ADD8E6",
               "Hurricane (2000-2016)" = "blue")) +
    theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
